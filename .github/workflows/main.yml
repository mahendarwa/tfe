
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Python & WinRM Dependencies
        run: |
          sudo apt update && sudo apt install -y python3-pip
          pip install pypsrp

      - name: Connect to Windows Server & Run Command
        env:
          WIN_HOST: "HSTNCMSRDIQA02.healthspring.inside"
          WIN_USER: "internal\\c8x6k9"
          WIN_PASSWORD: "Dev2s@mpath"
        run: |
          python3 - <<EOF
          from pypsrp.client import Client
          client = Client("${{ env.WIN_HOST }}", username="${{ env.WIN_USER }}", password="${{ env.WIN_PASSWORD }}", auth="ntlm", encryption="auto")
          stdout, stderr, rc = client.execute_cmd("whoami")
          print(stdout)
          EOF
