name: Test SQL Server Connection

on:
  workflow_dispatch:

jobs:
  test-sql-connection:
    runs-on: self-hosted
    steps:
      - name: Test SQL Connection with PowerShell
        shell: pwsh
        run: |
          $ServerName = "your-sql-server-name"
          $UserName = "your-sql-username"
          $Password = "your-sql-password"

          $connectionString = "Server=$ServerName;Database=master;User Id=$UserName;Password=$Password;"
          try {
              $connection = New-Object System.Data.SqlClient.SqlConnection
              $connection.ConnectionString = $connectionString
              $connection.Open()
              Write-Host "✅ Connection to SQL Server successful!"
              $connection.Close()
          } catch {
              Write-Host "❌ Connection failed: $_"
              exit 1
          }

      - name: Run SQL Query using SQLCMD
        shell: pwsh
        run: |
          $ServerName = "your-sql-server-name"
          $UserName = "your-sql-username"
          $Password = "your-sql-password"
          $Query = "SELECT GETDATE();"

          sqlcmd -S $ServerName -U $UserName -P $Password -Q "$Query" || exit 1

      - name: Confirm workflow completed
        shell: pwsh
        run: Write-Host "✅ GitHub Actions Workflow Completed Successfully!"
