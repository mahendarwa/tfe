name: Print Actor

on:
  workflow_dispatch:

jobs:
  validate-actor:
    runs-on: qa14-runner
    env:
      USERS: ${{ vars.USERS }}
    steps:
      - name: Print GitHub Actor
        run: |
          echo "Triggered by: ${{ github.actor }}"

      - name: Check if actor is in USERS list
        run: |
          ACTOR="${{ github.actor }}"
          USER_LIST="${USERS}"
          echo "User list: $USER_LIST"
          echo "Actor: $ACTOR"

          IFS=',' read -ra USERS_ARRAY <<< "$USER_LIST"
          FOUND=false
          for user in "${USERS_ARRAY[@]}"; do
            if [[ "$user" == "$ACTOR" ]]; then
              FOUND=true
              break
            fi
          done

          if [[ "$FOUND" == "true" ]]; then
            echo "$ACTOR is authorized"
          else
            echo "$ACTOR is NOT authorized"
            exit 1
          fi
