steps:
  - name: Checkout code
    uses: actions/checkout@v2
    with:
      token: ${{ secrets.MY_GITHUB_TOKEN }}

  - name: Deploy to Dev Environment
    run: |
      set -x
      ping -c 2 HDCLAPPXD027.HealthSpring.Inside
      
      # Debug environment
      hostname
      pwd
      whoami

      # Setup SSH
      mkdir -p /home/runner/.ssh
      chmod 700 /home/runner/.ssh
      echo "${{ secrets.SSH_PRIVATE_KEY }}" > /home/runner/.ssh/id_rsa
      chmod 600 /home/runner/.ssh/id_rsa

      # Debug SSH key setup
      ls -l /home/runner/.ssh/
      
      # Check if SSH daemon is running on the remote server
      nc -zv HDCLAPPXD027.HealthSpring.Inside 22 || echo "SSH port not open"

      # Scan SSH host key
      ssh-keyscan -H HDCLAPPXD027.HealthSpring.Inside >> /home/runner/.ssh/known_hosts || echo "SSH keyscan failed"

      # Test SSH connection
      ssh -vvv -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null gitactions@HDCLAPPXD027.HealthSpring.Inside "echo 'SSH connection successful'"
