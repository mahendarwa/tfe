name: QA PAT

on:
  workflow_dispatch:
    inputs:
      Environment:
        description: 'Select the Environment'
        required: true
        type: choice
        options:
          - pflqa00
          - pflqa12
          - pflqa22
          - pflqa36

jobs:
  setup:
    runs-on: qa-runner
    outputs:
      ADMIN_USR: ${{ steps.set_vars.outputs.ADMIN_USR }}
    steps:
      - name: Set Admin User and Path
        id: set_vars
        run: |
          case "${{ github.event.inputs.Environment }}" in
            pflqa12)
              echo "ADMIN_USR=pfmgr2" >> $GITHUB_ENV
              echo "ADMIN_USR=pfmgr2" >> $GITHUB_OUTPUT
              ;;
            pflqa22)
              echo "ADMIN_USR=pfmgr3" >> $GITHUB_ENV
              echo "ADMIN_USR=pfmgr3" >> $GITHUB_OUTPUT
              ;;
            pflqa36)
              echo "ADMIN_USR=pfmgr4" >> $GITHUB_ENV
              echo "ADMIN_USR=pfmgr4" >> $GITHUB_OUTPUT
              ;;
            pflqa00)
              echo "ADMIN_USR=pfmgr" >> $GITHUB_ENV
              echo "ADMIN_USR=pfmgr" >> $GITHUB_OUTPUT
              ;;
            *)
              echo "Invalid Environment choice."
              exit 1
              ;;
          esac

      - name: Debug Variables
        run: |
          echo "Environment: ${{ github.event.inputs.Environment }}"
          echo "Admin User: ${{ env.ADMIN_USR }}"

  pat:
    needs: setup
    runs-on: qa-runner
    env:
      ADMIN_USR: ${{ needs.setup.outputs.ADMIN_USR }}
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Print current directory
        run: pwd

      - name: Debug Variables
        run: |
          echo "Environment: ${{ github.event.inputs.Environment }}"
          echo "Admin User: $ADMIN_USR"
          echo "SSH Command: ssh -o StrictHostKeyChecking=no -i ~/.ssh/vscode ${ADMIN_USR}@daylnxcpsq014.enterprisenet.org 'ls'"

      - name: Execute SSH Commands for PAT
        run: |
          if [ -z "$ADMIN_USR" ]; then
            echo "ADMIN_USR is not set!"
            exit 1
          fi

          ssh -o StrictHostKeyChecking=no -i ~/.ssh/vscode "${ADMIN_USR}@daylnxcpsq014.enterprisenet.org" "chmod -R 750 /${{ github.event.inputs.Environment }}/bin/*"
