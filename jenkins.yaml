      - name: Kill and Restart PAT Service
        env:
          ADMINUSER: ${{ steps.map.outputs.adminuser }}
          SERVER: ${{ steps.map.outputs.server }}
          PORT: ${{ steps.map.outputs.port }}
          ENVNAME: ${{ github.event.inputs.prod_envi }}
        run: |
          echo "Resolved values:"
          echo "ADMINUSER=$ADMINUSER"
          echo "SERVER=$SERVER"
          echo "PORT=$PORT"
          echo "ENVNAME=$ENVNAME"

          if [ -z "$PORT" ]; then
            echo "PORT is not set. Exiting..."
            exit 1
          fi

          ssh -o StrictHostKeyChecking=no "$ADMINUSER@$SERVER.enterprisenet.org" bash <<EOSSH
          echo "Checking for process on port $PORT..."
          pid=\$(lsof -i :$PORT -sTCP:LISTEN -t)
          if [ -n "\$pid" ]; then
            echo "Found PID \$pid, killing..."
            kill -9 \$pid || exit 1
            echo "Killed PID \$pid successfully"
          else
            echo "No process found on port $PORT"
          fi
          
          cd /$ENVNAME/bin || echo "Directory not found"
          nohup ./startPATservice_$ENVNAME.sh > /dev/null 2>&1 &
          echo "Service restarted"
          EOSSH
