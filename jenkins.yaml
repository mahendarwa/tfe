name: Trigger QA Workflow in bcc-patservice

on:
  workflow_dispatch:
    inputs:
      Environment:
        description: 'Select the Environment'
        required: true
        type: choice
        options:
          - pflqa00
          - pflqa12
          - pflqa22
          - pflqa36
          - pflqa42

jobs:
  trigger-qa:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Get QA Workflow ID from bcc-patservice
        id: get_workflow_id
        run: |
          WORKFLOW_ID=$(curl -s -X GET \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: Bearer ${{ secrets.PAT_TOKEN }}" \
            "https://api.github.com/repos/niq-enterprise/bcc-patservice/actions/workflows" | 
            jq '.workflows[] | select(.path == ".github/workflows/qa.yml") | .id')
          
          if [ -z "$WORKFLOW_ID" ]; then
            echo "Error: Could not find qa.yml workflow ID"
            exit 1
          fi
          
          echo "workflow_id=$WORKFLOW_ID" >> $GITHUB_ENV

      - name: Trigger QA Workflow in bcc-patservice
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: Bearer ${{ secrets.PAT_TOKEN }}" \
            "https://api.github.com/repos/niq-enterprise/bcc-patservice/actions/workflows/${{ env.workflow_id }}/dispatches" \
            -d '{"ref": "trn/feature/jan31", "inputs": {"Environment": "${{ github.event.inputs.Environment }}"}}'
