      - name: Kill and Restart PAT Service
        env:
          ADMINUSER: ${{ steps.map.outputs.adminuser }}
          SERVER: ${{ steps.map.outputs.server }}
          PORT: ${{ steps.map.outputs.port }}
          ENVNAME: ${{ matrix.envname }}
        run: |
          echo "Resolved values:"
          echo "ADMINUSER=$ADMINUSER"
          echo "SERVER=$SERVER"
          echo "PORT=$PORT"
          echo "ENVNAME=$ENVNAME"
          if [ -z "$PORT" ]; then
            echo "PORT is not set. Exiting..."
            exit 1
          fi

          LOGS=$(ssh -o StrictHostKeyChecking=no "$ADMINUSER@$SERVER.enterprisenet.org" bash <<EOSSH
            echo "Checking for process on port $PORT..."
            pid=\$(lsof -i :$PORT -sTCP:LISTEN -t)
            if [ -n "\$pid" ]; then
              echo "Found PID \$pid, killing..."
              kill -9 \$pid || exit 1
              echo "Killed PID \$pid successfully"
            else
              echo "No process found on port $PORT"
            fi
            cd /$ADMINUSER/bin || { echo "âŒ /$ADMINUSER/bin not found"; exit 1; }
            nohup ./startPGPATservice_$ENVNAME.sh > /dev/null 2>&1 &
            echo "âœ… Service restarted for $ENVNAME"
          EOSSH
          )

          echo "ðŸ“‹ Captured logs:"
          echo "$LOGS"
