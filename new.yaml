- name: Execute SSH Commands
  run: |
    ssh -o StrictHostKeyChecking=no -i ~/.ssh/vscode "${ADMIN_USR}"@daylnxcpsq014.enterprisenet.org bash -s <<'EOF'
      chmod 750 /${{ matrix.env_name }}/bin
      chmod -R 750 /${{ matrix.env_name }}/bin/* || true
      cp -rv /tmp/actions/* /${{ matrix.env_name }}/bin/
      find ${ORG_PATH}ETL/config_pg/SQA/${PATH_ENV} -type f -exec cp -v {} /${{ matrix.env_name }}/bin/etl/config_pg/ \;
      cp -rvf ${ORG_PATH}ETL/scripts_pg/* /${{ matrix.env_name }}/bin/etl/scripts_pg/
      cp -rvf ${ORG_PATH}ETL/sql_pg/* /${{ matrix.env_name }}/bin/etl/sql_pg/
      cp -rvf ${ORG_PATH}ETL/ref_pg/* /${{ matrix.env_name }}/bin/etl/ref_pg/
      cp -rvf ${ORG_PATH}unix/PFW_UNIX/shellscripts_pg/* /${{ matrix.env_name }}/bin/

      # Replace only the auth_key line with GitHub secret
      sed -i "s|^auth_key=.*|auth_key=${SECRET_QA_AUTH}|" /${{ matrix.env_name }}/bin/etl/config_pg/pat_etl_config.ini

      chmod -R 750 /${{ matrix.env_name }}/bin/* || true
      chmod -R 550 /${{ matrix.env_name }}/bin/* || true
      chgrp -R stdd /${{ matrix.env_name }}/bin/* || true
      chmod -R 550 /${{ matrix.env_name }}/bin || true
EOF
  env:
    SECRET_QA_AUTH: ${{ secrets.SECRET_QA_AUTH }}
